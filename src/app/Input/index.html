<header class='start-here clearfix'>
	<select bind:value='selectedExample'>
		<option disabled>Select an example...</option>
		{{#each examples as example}}
			<option value='{{example}}'>{{example.name}}</option>
		{{/each}}
	</select>

	<button on:click='clear()'>Start over</button>
</header>

{{#each modules as module, i}}
	<Module bind:module index='{{i}}' main='{{i===0}}'/>
{{/each}}

<button class='new-module' on:click='createModule()'><span class='icon icon-plus'></span> add module</button>

<style>
	strong {
		line-height: 2;
	}

	.new-module {
		display: block;
		width: 100%;
		color: #3D9970;
		border: none;
		padding: 1em;
		margin-bottom: 0;
	}

	button {
		float: right;
	}
</style>

<script>
	import Module from './Module.html';
	import { dirname, resolve, extname } from '../utils/path';

	let uid = 1;

	export default {
		data: () => ({
			selectedExample: null,
			modules: []
		}),

		components: {
			Module,
		},

		oncreate () {
			this.observe( 'selectedExample', example => {
				if ( !example ) return;

				// console.group( 'selectedExample changed' );
				// console.log( `example`, example )

				const modules = Object.keys( example.modules ).map( key => {
					return {
						name: `${key}.js`,
						code: example.modules[ key ].trim()
					};
				});

				modules.sort( ( a, b ) => {
					if ( a.name === 'main.js' ) return -1;
					if ( b.name === 'main.js' ) return 1;

					return a.name < b.name ? -1 : 1;
				});

				// console.log( modules );

				this.set({ modules });

				// console.groupEnd();
			});
		},

		methods: {
			removeModule ( index ) {
				this.splice( 'modules', index, 1 );
			},

			createModule () {
				this.push( 'modules', {
					name: `module_${uid++}.js`,
					code: ''
				});

				const view = this.findAllComponents( 'Module' ).pop();
				view.find( 'input' ).select();
			},

			clear () {
				this.set({
					modules: [{ name: 'main.js', code: '' }],
					selectedExample: null
				});
			}
		}
	};
</script>
